"use strict";(self["webpackChunkplant"]=self["webpackChunkplant"]||[]).push([[177],{9177:function(t,e,n){n.r(e),n.d(e,{default:function(){return r}});var a=function(){var t=this,e=t._self._c;return e("div",{ref:"danmu_box",staticClass:"same_width_height danmu_box"})},s=[],d=n(3518),m={name:"danmu",data(){return{interval_create_danmu:"",danmuLenght:"",danmuTracks:[],danmuTrackWidth:NaN,addCommentTask:""}},computed:{...(0,d.aH)({comments:t=>t.comments.randomComments})},methods:{getComments(){this.$store.dispatch("comments/sendRandomComments")},randomDanmu(){this.danmuLenght||(this.danmuLenght=this.comments.length);let t=Math.floor(Math.random()*this.danmuLenght);return this.comments[t].comment},addComment(){let t,e,n=this.$refs.danmu_box,a=document.createElement("div"),s=this.randomDanmu();while(12*s.length<this.danmuTrackWidth)s+="\t".repeat(Math.floor(10*Math.random()))+this.randomDanmu();for(let d=0;d<this.danmuTracks.length;d++)if(!this.danmuTracks[d]){t=d,e=30*d,this.danmuTracks[d]=!0;break}a.textContent=s,a.style.top=`${e}px`,a.classList.add("danmu"),n.appendChild(a),a.addEventListener("animationend",(()=>{n.removeChild(a),this.danmuTracks[t]=!1}))},intevalAdd(){this.addCommentTask=setInterval((()=>{this.addComment()}),2e3)},handlePageTab(){"visible"==document.visibilityState?(console.log("页面改变进入页面"),this.intevalAdd()):clearInterval(this.addCommentTask)}},mounted(){let t=this.$refs.danmu_box;console.log(t);let e=Math.floor(t.offsetHeight/30);this.danmuTracks=new Array(e).fill(!1),this.danmuTrackWidth=t.offsetWidth,this.getComments(),this.intevalAdd(),document.addEventListener("visibilitychange",this.handlePageTab)},beforeDestroy(){clearInterval(this.addCommentTask),document.removeEventListener("visibilitychange",this.handlePageTab)}},i=m,o=n(1656),h=(0,o.A)(i,a,s,!1,null,null,null),r=h.exports}}]);
//# sourceMappingURL=177.4ce0d0b1.js.map