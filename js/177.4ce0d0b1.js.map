{"version":3,"file":"js/177.4ce0d0b1.js","mappings":"sJAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,IAAI,YAAYC,YAAY,+BACzG,EACIC,EAAkB,G,UCItB,GACAC,KAAA,QACAC,IAAAA,GACA,OACAC,sBAAA,GACAC,YAAA,GACAC,YAAA,GACAC,gBAAAC,IAEAC,eAAA,GAEA,EACAC,SAAA,KACAC,EAAAA,EAAAA,IAAA,CACAC,SAAAC,GAAAA,EAAAD,SAAAE,kBAGAC,QAAA,CAEAC,WAAAA,GACA,KAAAC,OAAAC,SAAA,8BACA,EAEAC,WAAAA,GACA,KAAAd,cACA,KAAAA,YAAA,KAAAO,SAAAQ,QAEA,IAAAC,EAAAC,KAAAC,MAAAD,KAAAE,SAAA,KAAAnB,aACA,YAAAO,SAAAS,GAAAI,OACA,EAEAC,UAAAA,GACA,IAQAC,EACAC,EATAC,EAAA,KAAAC,MAAAC,UACAC,EAAAC,SAAAC,cAAA,OACAC,EAAA,KAAAhB,cAEA,SAAAgB,EAAAf,OAAA,KAAAb,gBACA4B,GACA,KAAAC,OAAAd,KAAAC,MAAA,GAAAD,KAAAE,WAAA,KAAAL,cAIA,QAAAkB,EAAA,EAAAA,EAAA,KAAA/B,YAAAc,OAAAiB,IACA,SAAA/B,YAAA+B,GAAA,CACAV,EAAAU,EACAT,EAAA,GAAAS,EACA,KAAA/B,YAAA+B,IAAA,EACA,KACA,CAEAL,EAAAM,YAAAH,EACAH,EAAAO,MAAAC,IAAA,GAAAZ,MACAI,EAAAS,UAAAC,IAAA,SACAb,EAAAc,YAAAX,GAEAA,EAAAY,iBAAA,qBACAf,EAAAgB,YAAAb,GACA,KAAA1B,YAAAqB,IAAA,IAEA,EAEAmB,UAAAA,GACA,KAAArC,eAAAsC,aAAA,KACA,KAAArB,YAAA,GACA,IACA,EAEAsB,aAAAA,GAEA,WAAAf,SAAAgB,iBACAC,QAAAC,IAAA,YACA,KAAAL,cAIAM,cAAA,KAAA3C,eAEA,GAEA4C,OAAAA,GAEA,IAAAxB,EAAA,KAAAC,MAAAC,UACAmB,QAAAC,IAAAtB,GACA,IAAAyB,EAAAhC,KAAAC,MAAAM,EAAA0B,aAAA,IACA,KAAAjD,YAAA,IAAAkD,MAAAF,GAAAG,MAAA,GAEA,KAAAlD,gBAAAsB,EAAA6B,YAEA,KAAA1C,cAEA,KAAA8B,aAEAb,SAAAW,iBAAA,wBAAAI,cACA,EACAW,aAAAA,GACAP,cAAA,KAAA3C,gBACAwB,SAAA2B,oBAAA,wBAAAZ,cACA,GCvG+P,I,UCQ3Pa,GAAY,OACd,EACAnE,EACAO,GACA,EACA,KACA,KACA,MAIF,EAAe4D,EAAiB,O","sources":["webpack://plant/./src/page/emoAnalysis/comment.vue","webpack://plant/src/page/emoAnalysis/comment.vue","webpack://plant/./src/page/emoAnalysis/comment.vue?b165","webpack://plant/./src/page/emoAnalysis/comment.vue?8249"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{ref:\"danmu_box\",staticClass:\"same_width_height danmu_box\"})\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"same_width_height danmu_box\" ref=\"danmu_box\"></div>\r\n</template>\r\n\r\n<script>\r\nimport { mapState } from \"vuex\";\r\nexport default {\r\n  name: \"danmu\",\r\n  data() {\r\n    return {\r\n      interval_create_danmu: \"\", // 间隔生成弹幕\r\n      danmuLenght: \"\", // 弹幕数量\r\n      danmuTracks: [], // 弹幕轨道\r\n      danmuTrackWidth: NaN, //弹幕轨道宽度\r\n      // 弹幕定时生成器\r\n      addCommentTask: \"\",\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      comments: (state) => state.comments.randomComments,\r\n    }),\r\n  },\r\n  methods: {\r\n    // 获取弹幕\r\n    getComments() {\r\n      this.$store.dispatch(\"comments/sendRandomComments\");\r\n    },\r\n    // 随机取一个弹幕\r\n    randomDanmu() {\r\n      if (!this.danmuLenght) {\r\n        this.danmuLenght = this.comments.length;\r\n      }\r\n      let randomValue = Math.floor(Math.random() * this.danmuLenght);\r\n      return this.comments[randomValue].comment;\r\n    },\r\n    // 添加弹幕\r\n    addComment() {\r\n      let danmuBox = this.$refs.danmu_box;\r\n      let danmu = document.createElement(\"div\");\r\n      let text = this.randomDanmu();\r\n      // 弹幕长度必须大于offsetWidth\r\n      while (text.length * 12 < this.danmuTrackWidth) {\r\n        text +=\r\n          \"\\t\".repeat(Math.floor(Math.random() * 10)) + this.randomDanmu();\r\n      }\r\n      let user_track;\r\n      let topLenght;\r\n      for (let i = 0; i < this.danmuTracks.length; i++) {\r\n        if (!this.danmuTracks[i]) {\r\n          user_track = i;\r\n          topLenght = 30 * i;\r\n          this.danmuTracks[i] = true;\r\n          break;\r\n        }\r\n      }\r\n      danmu.textContent = text;\r\n      danmu.style.top = `${topLenght}px`;\r\n      danmu.classList.add(\"danmu\");\r\n      danmuBox.appendChild(danmu);\r\n      // 动画事件结束后删除元素\r\n      danmu.addEventListener(\"animationend\", () => {\r\n        danmuBox.removeChild(danmu);\r\n        this.danmuTracks[user_track] = false;\r\n      });\r\n    },\r\n    // 定时添加弹幕\r\n    intevalAdd() {\r\n      this.addCommentTask = setInterval(() => {\r\n        this.addComment();\r\n      }, 2000);\r\n    },\r\n    // 处理pageTab页面变化\r\n    handlePageTab() {\r\n      // 进入页面\r\n      if (document.visibilityState == \"visible\") {\r\n        console.log(\"页面改变进入页面\");\r\n        this.intevalAdd();\r\n      }\r\n      // 离开页面\r\n      else {\r\n        clearInterval(this.addCommentTask);\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    // 计算弹幕轨道数量\r\n    let danmuBox = this.$refs.danmu_box;\r\n    console.log(danmuBox);\r\n    let maxTracks = Math.floor(danmuBox.offsetHeight / 30);\r\n    this.danmuTracks = new Array(maxTracks).fill(false);\r\n    // 弹幕轨道宽度\r\n    this.danmuTrackWidth = danmuBox.offsetWidth;\r\n    // 获取弹幕\r\n    this.getComments();\r\n    // 添加弹幕\r\n    this.intevalAdd();\r\n    // 监听页面改变\r\n    document.addEventListener(\"visibilitychange\", this.handlePageTab);\r\n  },\r\n  beforeDestroy() {\r\n    clearInterval(this.addCommentTask);\r\n    document.removeEventListener(\"visibilitychange\", this.handlePageTab);\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.danmu_box {\r\n  position: relative;\r\n  background-color: black;\r\n  overflow: hidden;\r\n}\r\n.danmu {\r\n  position: absolute;\r\n  line-height: 30px;\r\n\r\n  /* border: 1px solid white; */\r\n  border-radius: 10px;\r\n  left: 99%;\r\n  white-space: pre;\r\n  color: white;\r\n  animation-name: moveLeft;\r\n  animation-timing-function: linear;\r\n  animation-duration: 30s;\r\n  /* background-color: aliceblue; */\r\n  /* transition: 3 linear; */\r\n}\r\n@keyframes moveLeft {\r\n  from {\r\n    left: 100%;\r\n  }\r\n  to {\r\n    left: calc(-100% - 100vw);\r\n  }\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./comment.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./comment.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./comment.vue?vue&type=template&id=64a6c390\"\nimport script from \"./comment.vue?vue&type=script&lang=js\"\nexport * from \"./comment.vue?vue&type=script&lang=js\"\nimport style0 from \"./comment.vue?vue&type=style&index=0&id=64a6c390&prod&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","ref","staticClass","staticRenderFns","name","data","interval_create_danmu","danmuLenght","danmuTracks","danmuTrackWidth","NaN","addCommentTask","computed","mapState","comments","state","randomComments","methods","getComments","$store","dispatch","randomDanmu","length","randomValue","Math","floor","random","comment","addComment","user_track","topLenght","danmuBox","$refs","danmu_box","danmu","document","createElement","text","repeat","i","textContent","style","top","classList","add","appendChild","addEventListener","removeChild","intevalAdd","setInterval","handlePageTab","visibilityState","console","log","clearInterval","mounted","maxTracks","offsetHeight","Array","fill","offsetWidth","beforeDestroy","removeEventListener","component"],"sourceRoot":""}